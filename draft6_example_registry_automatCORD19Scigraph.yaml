## example of using the x-bte-association-retrieval schema 
##   to write registry entries for querying Automat CORD19 Scigraph API
##   (current registry's 6 operations)
## notes about this specific registry entry: 
## - some API/JSON-response fields weren't used 
## - API has a lot of operations that aren't described here

## notes for developers:
## - this registry file is related to other files: BTE code and an example of
##   a processed association. 
## this is 79 char long #######################################################

## notes for CX: @@
## - how to handle the output responseField when sometimes it's in the first node [0] and sometimes in the second node [2], based on whether the expected direction or inverse direction association is returned...
##   notice how the response fields seem diff from in the current registry file: 
##     https://github.com/NCATS-Tangerine/translator-api-registry/blob/master/scigraph/smartapi.yaml#L122
## - are CHEMBL.COMPOUND and DOID still used for node IDs? I removed them here. if added back in, would inputs/[0]/id be a list or another entry in inputs (same for outputs)?
## - set the predicates as static, even tho there is a responseField for them?
## - are associations reliable for non-coronavirus questions? some kind of restriction / context for coronavirus Q only (currently in provenance -> CORD19 -> sourceContext)? 
## - queryInfo/parameters is different format for operations 3-6 compared to gene-input operations 1-2. keep or change this? 
    
## questions for RENCI:
## - the raw API/JSON-response has a publications field, but I always see an
##   empty array...
## - are CHEMBL.COMPOUND and DOID still used for node IDs? 
## - operations return associations with the inverse-relationship as well...
##   (ex: gene2disease returns disease -> gene associations as well)
## - see notes labeled "??" and address

components:      
  x-bte-association-retrieval:  
    gene2chemical:  ## 1
    ## current API response example:
    ## https://automat.renci.org/cord19-scigraph/gene/chemical_substance/NCBIGene:1803    
      queryInfo:  ## required
        supportBatch: false
        parameters:
          geneid: "NCBIGene:{inputs[0]}"
      inputs:  ## required
      - id: NCBIGene
        semantic: Gene
        requiresPrefix: true
      outputs:   ## required
      ## @@ is CHEMBL.COMPOUND still used for node IDs? 
      - id: CHEBI
        semantic: ChemicalSubstance  
        containsPrefix: true
        responseField: "[2].id"
      predicateInfo:  
      ## biolink / id / label use the takesOnResponseValue sub-schema
        biolink:   ## ?? is this the biolink predicate?
          responseField: "[1].relation_label"  
        id:   ## currently SEMMEDDB:ASSOCIATED_WITH
          responseField: "[1].relation"      
        nodesConflated:  ## optional 
        - original: Gene
          conflated: GeneProduct
          where: "Automat CORD19 Scigraph API"    
      ## ?? not sure if this provenance is correct
      provenance:  ## reused; same for all operations
        $ref: '#/definitions/automatProvenance'
      ## ?? not sure if any of this below is correct 
      numericMeasures:    ## reused; same for all operations
        $ref: '#/definitions/automatNumbers' 
    gene2disease:  ## 2
    ## current API response example:
    ## https://automat.renci.org/cord19-scigraph/gene/disease/NCBIGene:1803
      queryInfo:  
        supportBatch: false
        parameters:
          geneid: "NCBIGene:{inputs[0]}"
      inputs:  
      - id: NCBIGene
        semantic: Gene
        requiresPrefix: true
      outputs:   
      ## @@ is DOID still used for node IDs? 
      - id: MONDO
        semantic: Disease  
        containsPrefix: true
        responseField: "[2].id"
      predicateInfo:  
        biolink:  
          responseField: "[1].relation_label"  
        id:   
          responseField: "[1].relation"      
        nodesConflated:  
        - original: Gene
          conflated: GeneProduct
          where: "Automat CORD19 Scigraph API"
        ## since MONDO kinda includes both
        - original: Disease
          conflated: PhenotypicFeature
          where: "Automat CORD19 Scigraph API"  
      provenance:  
        $ref: '#/definitions/automatProvenance'
      numericMeasures:    
        $ref: '#/definitions/automatNumbers'    
    chemical2gene:  ## 3
    ## current API response example:
    ## https://automat.renci.org/cord19-scigraph/chemical_substance/gene/CHEBI:46195
      queryInfo:  
        supportBatch: false
        parameters:  
          chebi: "{inputs[0]}"
      inputs:  
      - id: CHEBI
        semantic: ChemicalSubstance
        requiresPrefix: true
      outputs:   
      - id: NCBIGene
        semantic: Gene  
        containsPrefix: true
        responseField: "[2].id"
      predicateInfo:  
        biolink:  
          responseField: "[1].relation_label"  
        id:  
          responseField: "[1].relation"      
        nodesConflated:  
        - original: Gene
          conflated: GeneProduct
          where: "Automat CORD19 Scigraph API"
      provenance:  
        $ref: '#/definitions/automatProvenance'
      numericMeasures:    
        $ref: '#/definitions/automatNumbers'
    chemical2disease:  ## 4
    ## current API response example:
    ## https://automat.renci.org/cord19-scigraph/chemical_substance/disease/CHEBI:46195
      queryInfo:  
        supportBatch: false
        parameters: 
          chebi: "{inputs[0]}"
      inputs:  
      - id: CHEBI
        semantic: ChemicalSubstance
        requiresPrefix: true
      outputs:  
      ## @@ I'm not sure if they give DOID as primary ID anymore
      - id: MONDO
        semantic: Disease  
        containsPrefix: true
        responseField: "[2].id"   
      predicateInfo:  
        biolink:  
          responseField: "[1].relation_label"  
        id:   
          responseField: "[1].relation"      
        nodesConflated:  
        ## since MONDO kinda includes both
        - original: Disease
          conflated: PhenotypicFeature
          where: "Automat CORD19 Scigraph API"  
      provenance:  
        $ref: '#/definitions/automatProvenance'
      numericMeasures:    
        $ref: '#/definitions/automatNumbers'
    disease2gene:  ## 5
    ## current API response example:
    ## https://automat.renci.org/cord19-scigraph/disease/gene/MONDO:0005016
      queryInfo:  
        supportBatch: false
        parameters:   
          mondo: "{inputs[0]}"    
      inputs: 
      - id: MONDO
        semantic: Disease
        requiresPrefix: true
      outputs:  
      - id: NCBIGene
        semantic: Gene  
        containsPrefix: true
        responseField: "[2].id"  
      predicateInfo:  
        biolink:  
          responseField: "[1].relation_label"  
        id:  
          responseField: "[1].relation"      
        nodesConflated:  
        - original: Gene
          conflated: GeneProduct
          where: "Automat CORD19 Scigraph API"
        ## since MONDO kinda includes both
        - original: Disease
          conflated: PhenotypicFeature
          where: "Automat CORD19 Scigraph API"  
      provenance:  
        $ref: '#/definitions/automatProvenance'
      numericMeasures:    
        $ref: '#/definitions/automatNumbers'
    disease2chemical:    ## 6
    ## current API response example:
    ## https://automat.renci.org/cord19-scigraph/disease/chemical_substance/MONDO:0005016
      queryInfo:  
        supportBatch: false
        parameters:  
          mondo: "{inputs[0]}"    
      inputs:  
      - id: MONDO
        semantic: Disease
        requiresPrefix: true
      outputs:   
      ## @@ I'm not sure if they give CHEMBL.COMPOUND as primary ID anymore
      - id: CHEBI
        semantic: ChemicalSubstance  
        containsPrefix: true
        responseField: "[2].id"
      predicateInfo:  
        biolink:  
          responseField: "[1].relation_label"  
        id:   
          responseField: "[1].relation"      
        nodesConflated:  
        ## since MONDO kinda includes both
        - original: Disease
          conflated: PhenotypicFeature
          where: "Automat CORD19 Scigraph API"  
      provenance: 
        $ref: '#/definitions/automatProvenance'
      numericMeasures:    
        $ref: '#/definitions/automatNumbers'
## this is 79 char long #######################################################  
definitions:
  ## ?? not sure if this provenance is correct
  automatProvenance:
  - name: "Automat CORD19 Scigraph API"
    sourceType: NLP
    ## https://automat.renci.org/#/cord19-scigraph/about_about_get says V11.
    ##   but API/JSON-response has edge_source v2 and current registry file,
    ##   automat.renci.org both say v2...
    version: "v2"
    versionType: "version_number"
    method: ingest
    ## comes from reading 
    ## https://tarheelstogether.unc.edu/robokop-technology-offers-faster-easier-exploration-of-emerging-covid-19-research/
    descriptiveInfo: >- 
      Downloaded the Neo4J dump of the Automat CORD19 Scigraph Neo4J
      knowledgebase. The knowledgebase associations represent frequent
      co-occurrence of the biomedical entities in the CORD19 literature.
      Scigraph NLP was used for entity resolution
  - name: "CORD19 Dataset"
    sourceType: publications
    ## Automat doesn't give version info for this
    ## no method; it's a text source
    sourceReferences: 
      websites:   
        value: "https://www.semanticscholar.org/cord19/"
    descriptiveInfo: >- 
      Provides COVID-19 and coronavirus-related research articles (and
      standardized article metadata). Publications come from Pubmed (PMC open
      access corpus), WHO (a corpus maintained by them), bioRxiv, and medRxiv
      pre-prints
    sourceContext:
      diseaseSpecific:
        value:
        - "MONDO:0020753"  ## coronavirus infection
        - "MONDO:0100096"  ## COVID-19
  automatNumbers:     
  - name: "Automat enrichment p-value"
    responseField: "[1].enrichment_p"
    range:
      minExclusive: 0
      maxInclusive: 1
    directionMeaning:  
    ## small p-value means these two entities co-occur more often/consistently
    ##   than expected?
      smaller: more_probable  ## maybe more likely to be a "real" association
      ## based on statistics / network-based methods 
  - name: "Automat publications ratio"
    responseField: "[1].num_publications"
    range:
      minExclusive: 0
      maxInclusive: 1
    directionMeaning:  
    ## large number means these entities co-occur in more publications? 
      larger: more_evidence